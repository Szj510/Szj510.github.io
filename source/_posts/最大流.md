---
title: 最大流 (Maximum Flow)
date: 2024-05-30 22:53:00
tags: [算法, 图论, 网络流, 最大流]
categories: [算法]
description: 最大流问题学习笔记，介绍流网络、Ford-Fulkerson方法、Edmonds-Karp算法等内容。
mathjax: true
---

# 最大流(Maximum Flow)

## 流网络(Flow networks)

### 流网络和流

流网络$G = (V, E)$是一个有向带权图,权重非负,在这里称其为容量$c(u, v) \ge 0$。我们进一步要求如果 E 包含边(u, v),那么 E 就不包含反向边(v, u)。若$(u, v)\not \in E$,方便起见,我们定义 c(u, v) = 0,同时不允许自环。每一个流网络包含两个特殊顶点:源点 s 和汇点 t,这个汇点在基本图论中的习题中已接触过,当时是求一个图是否有全局汇点,这里的汇点意思没变,还是出度为 0。为了方便,我们假设每一个顶点都位于从 s 到 t 的某条路径上。因为除了 s 外的顶点都至少有一条入边,因此有$|E| \ge |V| - 1$。
接着对流进行正式的定义：
已知流网络$G=(V,E)$，c 是容量函数，s 是源点，t 是汇点，那么在 G 中的一个流是一个实值函数$f:V \times V \to R$，其满足下面两条性质：

- **容量限制**：$0 \le f(u, v) \le c(u, v)$
- **流量守恒**：对于所有的顶点$u \in V - \{s, t\}$，我们要求
  $$
  \sum_{v \in V}f(v,u) = \sum_{v \in V}f(u, v)
  $$
  即除了源点和汇点，流入一个顶点的总流量等于流出该顶点的总流量，就是流入等于流出。这跟基尔霍夫电流定律特性一样。
  我们称非负数值 f(u, v)为从顶点 u 到 v 的流，一个流 f 的值|f|定义如下：
  $$
  |f|=\sum_{v \in V}f(s, v)-\sum_{v \in V}f(v,s)
  $$
  即从源点流出的总流量减去流入源点的总能量。通常，一个流网络的源点是没有入边的，因此$\sum_{v\in V}f(v, s)$为 0，那么存在即合理，这里定义包含它是因为后面讲到残差网络 or 剩余网络 or 其它翻译(residual networks)，那时$\sum_{v\in V}f(v, s)>0$是可以的。
  最大流问题就是求$|f|$的最大值。
  下面是流网络的一个例子：
  ![image](https://telegraph-image-eja.pages.dev/file/0ea4104cb216c143ad4c8.png)
  (b)中的边都有两个数值，左边的数值代表流量，右边的数值代表容量，以顶点$v_3$为例，流入$v_3$的总流量为$12+7=19$，流出$v_3$的总流量为$15+4=19$，可见流入等于流出。

### 反向平行边

假设在上面图的基础上加多一条边，如图，该网络产生了一个问题，它违反了最上面的要求：如果 E 包含边(u, v)，那么 E 就不包含反向边(v, u)，我们称边$(v_1,v_2)$和边$(v_2,v_1)$互为反平行。
![image](https://telegraph-image-eja.pages.dev/file/06cc45f7a370a6c63456c.png)
因此，我们需要将有问题的网络等价转换为不包含反向平行边的网络，正如图(b)所示，我们可以从两条反向平行边任选其一，然后通过添加一个新顶点$v'$把原来的边$(v_1,v_2)$分解成两条边，并且新的两条边的容量都设为原来边$(v_1,v_2)$的容量。

### 多源点多汇点网络

![image](https://telegraph-image-eja.pages.dev/file/d8a054ff24bd0feaff874.png)
该图告诉我们如何将一个多源点多汇点网络转换成一个普通网络，s 为超级源点，t 为超级汇点。

## Ford-Fulkerson 方法

这里称作方法而不是算法是因为它包含几种运行时间不同的算法实现，以下简称 FF 方法。
FF 方法迭代增加流的值，一开始，对于所有的顶点对 u, v 都有 f(u, v) = 0，因此初始流值为 0。在每一次迭代中，通过在关联的残差网络$G_f$中找一条增广路径(augmenting path)，找出其在 G 中对应的边，接着更新这些边的流量，从而增加流的值。
尽管每一次迭代都增加了流的值，但对于 G 中的某条特定的边，其流量可能增加也可能减少。减少这个情况看上去有点违反直觉，但是实际情况却是会让其它边上的流量增加，使得从 s 到 t 的流最大化。伪代码如下：
![image](https://telegraph-image-eja.pages.dev/file/ded556038695346235b68.png)

### 残差网络(Residual networks)

前面已两次提到残差网络，现在正式介绍。
字面来看，残差或者剩余就是剩下的意思，那么流网络中有啥是剩下的呢，那就是容量了，前面规定流量要小于或等于容量，小于的时候不就有剩下的容量吗，而等于的时候就没有剩下的了，因此 G 中流量等于容量的边不属于$G_f$。残差网络也有容量，就称为残差容量，公式为$c_f(u,v) = c(u,v) - f(u,v)$。
你可能会感到惊讶，残差网络$G_f$还可能包含 G 中没有的边。前面提到算法可能会减少某条特定的边的流量，那么为了表示 G 中一条边(u, v)上的正流量可能的减少，我们在$G_f$中添加一条边(v, u)，并且$c_f(v,u)=f(u,v)$，
